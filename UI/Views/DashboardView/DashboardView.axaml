<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:HyPrism.UI.Views.DashboardView"
             xmlns:settingsView="using:HyPrism.UI.Views.SettingsView"
             xmlns:modManagerView="using:HyPrism.UI.Views.ModManagerView"
             xmlns:profileEditorView="using:HyPrism.UI.Views.ProfileEditorView"
             xmlns:launchOverlayView="using:HyPrism.UI.Views.LaunchOverlayView"
             xmlns:errorModalView="using:HyPrism.UI.Views.ErrorModalView"
             xmlns:newsView="using:HyPrism.UI.Views.NewsView"
             xmlns:layouts="using:HyPrism.UI.Components.Layouts.ModalWrapper"
             xmlns:header="using:HyPrism.UI.Components.Dashboard.Header"
             xmlns:gameControl="using:HyPrism.UI.Components.Dashboard.GameControlBar"
             mc:Ignorable="d" d:DesignWidth="1280" d:DesignHeight="800"
             x:Class="HyPrism.UI.Views.DashboardView.DashboardView"
             x:DataType="vm:DashboardViewModel"
             x:CompileBindings="True">

    <Grid>
        <!-- Content Root with Blur Effect -->
        <Grid Tag="{Binding IsOverlayOpen}">
            <Grid.Styles>
                <Style Selector="Grid[Tag=True]">
                    <Setter Property="Effect" Value="blur(16)"/>
                </Style>
            </Grid.Styles>

            <!-- Background -->
            <Image Source="{Binding BackgroundImage}" 
                   Stretch="UniformToFill" 
                   Opacity="{Binding BackgroundOpacity}">
                <Image.Transitions>
                    <Transitions>
                        <DoubleTransition Property="Opacity" Duration="0:0:0.4" Easing="CubicEaseInOut"/>
                    </Transitions>
                </Image.Transitions>
            </Image>
            
            <!-- Vignette effect (radial darkening at edges, matching Photino) -->
            <Border IsHitTestVisible="False">
                <Border.Background>
                    <RadialGradientBrush Center="50%,50%" RadiusX="0.7" RadiusY="0.7">
                        <GradientStop Color="Transparent" Offset="0"/>
                        <GradientStop Color="Transparent" Offset="0.4"/>
                        <GradientStop Color="#80000000" Offset="1"/>
                    </RadialGradientBrush>
                </Border.Background>
            </Border>
            
            <!-- Top-to-bottom gradient overlay for readability -->
            <Border IsHitTestVisible="False">
                <Border.Background>
                    <LinearGradientBrush StartPoint="50%,0%" EndPoint="50%,100%">
                        <GradientStop Color="#33000000" Offset="0"/>
                        <GradientStop Color="Transparent" Offset="0.3"/>
                        <GradientStop Color="Transparent" Offset="0.7"/>
                        <GradientStop Color="#66000000" Offset="1"/>
                    </LinearGradientBrush>
                </Border.Background>
            </Border> 
        
            <!-- Main Layout Grid -->
             <Grid Margin="30">
                <!-- Header Component -->
                <header:Header DataContext="{Binding HeaderViewModel}" VerticalAlignment="Top" />
                
                <!-- RIGHT PANEL: News (UserControl) -->
                <Grid VerticalAlignment="Stretch" 
                      HorizontalAlignment="Right"
                      Margin="0,140,0,80"
                      IsVisible="{Binding !DisableNews}">
                    <newsView:NewsView DataContext="{Binding NewsViewModel}"/>
                </Grid>                
                                
                <!-- Game Control Bar (Bottom Actions + Play) -->
                <gameControl:GameControlBar DataContext="{Binding GameControlViewModel}" VerticalAlignment="Bottom" />
            </Grid>
        </Grid>

        <!-- Settings Overlay -->
        <Grid Classes="overlay-layer" Tag="{Binding IsSettingsOpen}" ZIndex="100">
            <Border Background="#B3000000"/>
            <layouts:ModalWrapper IsOpen="{Binding IsSettingsOpen}">
                <layouts:LazyContentControl IsActive="{Binding IsSettingsOpen}">
                    <layouts:LazyContentControl.ContentTemplate>
                        <DataTemplate x:CompileBindings="False">
                            <settingsView:SettingsView DataContext="{Binding SettingsViewModel}" Width="900" Height="650" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                        </DataTemplate>
                    </layouts:LazyContentControl.ContentTemplate>
                </layouts:LazyContentControl>
            </layouts:ModalWrapper>
        </Grid>
        
        <!-- Mods Overlay -->
        <Grid Classes="overlay-layer" Tag="{Binding IsModsOpen}" ZIndex="100">
            <Border Background="#B3000000"/>
            <layouts:ModalWrapper IsOpen="{Binding IsModsOpen}">
                <layouts:LazyContentControl IsActive="{Binding IsModsOpen}">
                    <layouts:LazyContentControl.ContentTemplate>
                        <DataTemplate x:CompileBindings="False">
                            <modManagerView:ModManagerView DataContext="{Binding ModManagerViewModel}" Width="1100" Height="750" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                        </DataTemplate>
                    </layouts:LazyContentControl.ContentTemplate>
                </layouts:LazyContentControl>
            </layouts:ModalWrapper>
        </Grid>
        
        <!-- Profile Editor Overlay -->
        <Grid Classes="overlay-layer" Tag="{Binding IsProfileEditorOpen}" ZIndex="100">
            <Border Background="#B3000000"/>
            <layouts:ModalWrapper IsOpen="{Binding IsProfileEditorOpen}">
                <layouts:LazyContentControl IsActive="{Binding IsProfileEditorOpen}">
                    <layouts:LazyContentControl.ContentTemplate>
                        <DataTemplate x:CompileBindings="False">
                            <profileEditorView:ProfileEditorView DataContext="{Binding ProfileEditorViewModel}" Width="700" Height="600" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                        </DataTemplate>
                    </layouts:LazyContentControl.ContentTemplate>
                </layouts:LazyContentControl>
            </layouts:ModalWrapper>
        </Grid>
        
        <!-- Update/Download Progress Overlay -->
        <launchOverlayView:LaunchOverlayView DataContext="{Binding}"/>

        <!-- Error Modal -->
        <errorModalView:ErrorModalView DataContext="{Binding}"/>
        
    </Grid>
</UserControl>
