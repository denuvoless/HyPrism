app-id: io.github.HyPrismTeam.HyPrism
runtime: org.freedesktop.Platform
runtime-version: '25.08'
sdk: org.freedesktop.Sdk
base: org.electronjs.Electron2.BaseApp
base-version: '25.08'
command: hyprism-launcher-wrapper

sdk-extensions:
  - org.freedesktop.Sdk.Extension.node22

add-extensions:
  org.freedesktop.Platform.codecs_extra.i386:
    directory: lib/i386-linux-gnu/codecs-extra
    version: '25.08-extra'
    autodelete: false
    add-ld-path: lib
      
build-options:
  append-path: /usr/lib/sdk/node18/bin

finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --socket=pulseaudio
  - --share=network
  - --device=dri
  - --talk-name=org.freedesktop.Notifications
  - --env=LD_LIBRARY_PATH=/app/lib
  - --env=ELECTRON_TRASH=gio
  - --env=XCURSOR_PATH=/run/host/user-share/icons:/run/host/share/icons

modules:
  # - name: libpng
  #   buildsystem: autotools
  #   sources:
  #     - type: archive
  #       url: https://download.sourceforge.net/libpng/libpng-1.6.43.tar.xz
  #       sha256: 6a5ca0652392a2d7c9db2ae5b40210843c0bbc081cbd410825ab00cc59f14a6c

  # - name: SDL3
  #   buildsystem: cmake-ninja
  #   config-opts:
  #     - -DSDL_STATIC=OFF
  #     - -DSDL_TEST=OFF
  #   sources:
  #     - type: git
  #       url: https://github.com/libsdl-org/SDL.git
  #       tag: release-3.2.8

  # - name: SDL3_image
  #   buildsystem: cmake-ninja
  #   config-opts:
  #     - -DSDL3IMAGE_PNG=ON
  #     - -DSDL3IMAGE_BACKEND_STB=OFF
  #   sources:
  #     - type: git
  #       url: https://github.com/libsdl-org/SDL_image.git
  #       tag: release-3.2.4

  # - name: ffmpeg
  #   config-opts:
  #     - --enable-shared
  #     - --disable-static
  #     - --disable-doc
  #     - --disable-manpages
  #     - --disable-stripping
  #     - --disable-ffplay
  #     - --enable-ffprobe
  #     - --disable-lzma
  #     - --enable-runtime-cpudetect
  #     - --disable-xlib
  #     - --disable-libxcb-shm
  #     - --disable-libxcb-xfixes
  #     - --disable-libxcb-shape
  #     - --disable-outdevs
  #     - --disable-indevs
  #     - --enable-indev=lavfi
  #     - --disable-securetransport
  #     - --enable-runtime-cpudetect
  #     - --enable-gpl
  #     - --enable-version3
  #     - --enable-optimizations
  #     - --enable-pthreads
  #     - --enable-gnutls
  #     - --enable-libxcb-xfixes
  #     - --enable-opengl
  #     - --enable-sdl2
  #     - --enable-vaapi
  #     - --enable-vdpau
  #     - --enable-zlib
  #     - --enable-bzlib
  #     - --enable-lzma
  #     - --enable-fontconfig
  #     - --enable-libfontconfig
  #     - --enable-libfreetype
  #     - --enable-avcodec
  #     - --enable-avfilter
  #     - --enable-filters
  #     - --enable-avdevice
  #     - --enable-swscale
  #     - --enable-libxcb
  #     - --enable-protocol=file
  #   sources:
  #     - type: archive
  #       url: https://ffmpeg.org/releases/ffmpeg-8.0.1.tar.xz
  #       sha512: 7af5cd1c7ba04f8d7ea1b54b64b9c235f2a606dc0c18d25cfdf20958bcad4851d3265b4894fc6ba5dd205c2309971c7e7fb890ee1d64e0a41a3faf159f77957f
  #       x-checker-data:
  #         type: anitya
  #         project-id: 5405
  #         url-template: https://ffmpeg.org/releases/ffmpeg-$version.tar.xz
  #   cleanup:
  #     - /share/ffmpeg/examples

  - name: HyPrism
    buildsystem: simple
    build-commands:
      - mkdir -p /app/lib/i386-linux-gnu/codecs-extra
      - install -d /app/HyPrism
      - cp -R linux-unpacked/* /app/HyPrism
      - chmod +x /app/HyPrism/HyPrism
      - cp -R wwwroot /app/wwwroot
      - install -Dm755 hyprism-launcher-wrapper.sh /app/bin/hyprism-launcher-wrapper
      - install -Dm644 io.github.HyPrismTeam.HyPrism.png /app/share/icons/hicolor/256x256/apps/io.github.HyPrismTeam.HyPrism.png
      - install -Dm644 io.github.HyPrismTeam.HyPrism.desktop /app/share/applications/io.github.HyPrismTeam.HyPrism.desktop
      - install -Dm644 io.github.HyPrismTeam.HyPrism.metainfo.xml /app/share/metainfo/io.github.HyPrismTeam.HyPrism.metainfo.xml
      - ln -s /app/HyPrism/HyPrism /app/bin/HyPrism
    sources:
      - type: dir
        path: ../../../bin/Release/net10.0/linux-x64/publish/linux-unpacked
        dest: linux-unpacked
      - type: dir
        path: ../../../wwwroot
        dest: wwwroot
      - type: file
        path: hyprism-launcher-wrapper.sh
      - type: file
        path: io.github.HyPrismTeam.HyPrism.png
      - type: file
        path: hyprism-launcher-wrapper.sh
      - type: file
        path: io.github.HyPrismTeam.HyPrism.desktop
      - type: file
        path: io.github.HyPrismTeam.HyPrism.metainfo.xml
