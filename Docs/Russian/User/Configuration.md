# Настройка

HyPrism хранит свою конфигурацию в файле `config.json` в каталоге данных.

## Параметры

Доступ к настройкам осуществляется через страницу **Настройки** (значок шестерёнки в боковой панели).

### Общие

| Параметр | Описание | По умолчанию |
|----------|----------|--------------|
| Язык | Язык интерфейса (12 доступно) | Системный язык или en-US |
| Закрыть после запуска | Закрывать лаунчер при запуске игры | false |
| Запуск при старте системы | Автозапуск с ОС | false |
| Сворачивать в трей | Сворачивать в системный трей | false |

### Внешний вид

| Параметр | Описание | По умолчанию |
|----------|----------|--------------|
| Акцентный цвет | Акцентный цвет темы | Фиолетовый (#7C5CFC) |
| Анимации | Включить анимации интерфейса | true |
| Прозрачность | Эффекты glass-morphism | true |
| Режим фона | Стиль фона панели управления | default |

### Игра

| Параметр | Описание | По умолчанию |
|----------|----------|--------------|
| Разрешение | Разрешение окна игры | 1920x1080 |
| Звук | Включён ли звук в игре | true |
| Предпочтение GPU | Выбор видеоадаптера | auto |

### Java

| Параметр | Описание | По умолчанию |
|----------|----------|--------------|
| Java runtime | Встроенная Java или кастомный путь к исполняемому файлу | Встроенная Java |
| Максимум ОЗУ | Графический слайдер для максимальной памяти Java (`-Xmx`) | 4096 МБ |
| Начальное ОЗУ | Графический слайдер для начальной памяти Java (`-Xms`) | 1024 МБ |
| Сборщик мусора | Профиль Auto или явный профиль G1GC | Auto |
| Расширенные JVM-аргументы | Необязательные дополнительные JVM-флаги, передаваемые через JAVA_TOOL_OPTIONS (опасные флаги запуска фильтруются) | пусто |

- При выборе кастомной Java используйте кнопку **Выбрать** для выбора исполняемого файла и сохраняйте только после проверки пути.

#### Варианты предпочтения GPU

| Значение | Описание |
|----------|----------|
| auto | Система выбирает лучший GPU автоматически |
| dedicated | Принудительно использовать дискретную графику (NVIDIA/AMD) |
| integrated | Принудительно использовать интегрированную графику (Intel/AMD) |

### Расширенные

| Параметр | Описание | По умолчанию |
|----------|----------|--------------|
| Режим разработчика | Показывать инструменты разработчика | false |
| Подробное логирование | Расширенный вывод логов | false |
| Предварительные версии | Получать предрелизные обновления | false |
| Ветка лаунчера | Канал релизных или предрелизных версий | release |
| Каталог данных | Пользовательский путь хранения данных | Системный по умолчанию |
| Источник загрузки | Управляется автоматически лаунчером (official сначала, зеркала как fallback) | auto |
| Запуск после загрузки | Автоматически запускать игру после завершения установки/загрузки | true |

- При смене **Ветка лаунчера** лаунчер сразу выполняет проверку обновлений. При переключении между каналами (release ↔ beta) HyPrism предложит последний билд выбранного канала и может переустановить или понизить версию, чтобы соответствовать каналу.

#### Стратегия источника загрузки

- HyPrism всегда сначала пробует официальные источники Hytale.
- Если official-загрузка недоступна, лаунчер автоматически тестирует доступные зеркала и выбирает лучшее.
- Выбор зеркала не сохраняется как пользовательская настройка.
- Зеркала определяются JSON мета-файлами в папке `Mirrors/` (см. [Пользовательские зеркала](#пользовательские-зеркала) ниже).

## Пользовательские зеркала

HyPrism использует data-driven систему зеркал. Зеркала определяются файлами `.mirror.json` в папке `Mirrors/` в каталоге данных лаунчера. Дефолтные определения генерируются автоматически при первом запуске.

Полная документация по настройке зеркал — включая справочник по схеме, все типы источников, методы обнаружения версий, плейсхолдеры URL, аннотированные примеры всех встроенных зеркал и пошаговые руководства по созданию своих — в **[Руководстве по зеркалам](Mirrors.md)**.

## Управление экземплярами

Вместо единственной установки игры HyPrism использует **экземпляры** — изолированные установки игры в отдельных папках.

### Структура экземпляра

Каждый экземпляр хранится в `Instances/{GUID}/`, где `{GUID}` — уникальный идентификатор:

```
Instances/
├── a1b2c3d4-e5f6-7890-abcd-ef1234567890/
│   ├── game/           # Файлы игры
│   ├── mods/           # Установленные моды
│   └── instance.json   # Метаданные экземпляра
└── ...
```

### Управление экземплярами

- **Создать** — Загрузить новую установку игры
- **Переключить** — Выбрать экземпляр для запуска
- **Удалить** — Удалить экземпляр (требуется подтверждение)
- **Просмотреть детали** — Увидеть версию, статус патчей, установленные моды
- На дашборде переключатель экземпляров и основная кнопка действия центрируются как единая группа.
- Клик по плейсхолдеру экземпляра слева от кнопки «Играть» открывает страницу «Игры» на текущем выбранном экземпляре.
- Применение кастомных иконок жёстко привязано к уникальному экземпляру, чтобы одна иконка не отображалась сразу у нескольких записей.

## Профили

HyPrism поддерживает несколько профилей игрока. Переключайтесь между профилями через выбор профиля в боковой панели.

### Данные профиля

Каждый профиль хранит:
- **Никнейм** — Отображаемое имя в игре
- **UUID** — Уникальный идентификатор игрока
- **Аватар** — Изображение профиля (опционально)
- **Резервная копия скина** — Сохранённые данные скина

### Резервное копирование скина

Профили могут сохранять резервную копию вашего скина Hytale. Копии хранятся в:

```
Profiles/
├── {ProfileUUID}/
│   ├── profile.json    # Метаданные профиля
│   └── skin.png        # Резервная копия скина
└── ...
```

Используйте меню профиля для:
- **Создать резервную копию скина** — Сохранить текущий скин в профиль
- **Восстановить скин** — Применить сохранённый скин к аккаунту

## Режим запуска с кастомной авторизацией

Для неофициальных профилей с кастомным auth-доменом HyPrism запускается в режиме **online authenticated**.

- **Легаси патчинг JAR (по умолчанию):** Патчатся и клиентский бинарник, и `Server/HytaleServer.jar` — в них `hytale.com` заменяется на ваш кастомный auth-домен. Это стабильный, рекомендуемый подход.
- **DualAuth (экспериментальный):** Включается переключателем `DualAuth (Экспериментальный)` в основных настройках. Патчится только клиентский бинарник; серверная авторизация обрабатывается runtime Java Agent, который загружается с GitHub. Может вызывать вылеты — используйте на свой страх и риск.
- Переключение между режимами безопасно: лаунчер автоматически управляет бэкап-файлами `.original` при включении/выключении DualAuth.
- Auth-домен используется в точности как введён (например `auth.example.com`); HyPrism больше не добавляет `sessions.` принудительно.
- Для совместимости, если прямой хост недоступен, HyPrism автоматически пробует `sessions.<ваш-домен>`.

## Быстрые действия для экземпляров

- Вкладки контента экземпляра используют локализованные заголовки **Установленные моды** и **Обзор модов** для всех поддерживаемых языков интерфейса.

## Выбор модов (Installed Mods)

- **Клик** выбирает один мод.
- **Ctrl/Cmd + Клик** добавляет/убирает мод из выделения.
- **Shift + Клик** выделяет диапазон от якорного мода до выбранного.

Если выбрано несколько модов, действия **Включить выбранные** / **Выключить выбранные** применяются ко всему выделению.

## Импорт модов перетаскиванием

- В **Установленные моды** можно импортировать моды, перетащив файлы прямо в список.
- Поддерживаемые форматы: `.jar`, `.zip`, `.disabled`.
- Очень большие файлы и неподдерживаемые форматы пропускаются, чтобы избежать зависаний.
- После импорта список модов обновляется автоматически.
- Выделение не сохраняется при переключении вкладок или экземпляров.

## Логи в Настройках

- Встроенный раздел **Настройки → Логи** использует такой же стиль заголовка, как и остальные разделы настроек (без иконки).
- Панель вывода логов получила чуть более светлый фон для лучшей читаемости.

## Папка модов по умолчанию

- Управляемая папка модов расположена в данных экземпляра:
	- `HyPrism/Instances/<branch>/<instance-guid>/UserData/Mods`
- Это заменяет legacy-путь `Client/mods` для операций с модами.
- Переключение профиля не перенаправляет эту папку в `Profiles/.../Mods`; она остаётся внутри выбранного экземпляра.

## Файл конфигурации

**Расположение:**
- Windows: `%APPDATA%/HyPrism/config.json`
- Linux: `~/.local/share/HyPrism/config.json`
- macOS: `~/Library/Application Support/HyPrism/config.json`

Файл конфигурации имеет формат JSON и может редактироваться вручную, но рекомендуется использовать страницу Настройки.

### Каталог данных

HyPrism использует фиксированный каталог данных лаунчера в системном пути по умолчанию.

- Путь отображается в **Настройки** → **Данные**
- Перенос каталога данных лаунчера не поддерживается
- Для папки доступна кнопка **Открыть**
