<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:HyPrism.ViewModels"
        xmlns:cv="using:HyPrism.Converters"
        x:Class="HyPrism.ModManagerWindow"
        x:DataType="vm:ModManagerViewModel"
        Title="Mod Manager"
        Width="1100" Height="750"
        WindowStartupLocation="CenterOwner"
        SystemDecorations="None"
        Background="Transparent"
        TransparencyLevelHint="AcrylicBlur"
        ExtendClientAreaToDecorationsHint="True">

    <Window.Resources>
        <cv:StringEqualityConverter x:Key="StringEqualityConverter"/>
    </Window.Resources>

    <Window.Styles>
        <Style Selector="Button.NavButton">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#AAAAAA"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="Padding" Value="15,8"/>
            <Setter Property="Template">
                <ControlTemplate>
                    <Border Background="{TemplateBinding Background}" CornerRadius="6" Padding="{TemplateBinding Padding}">
                        <TextBlock Text="{TemplateBinding Content}" FontWeight="Medium"/>
                    </Border>
                </ControlTemplate>
            </Setter>
        </Style>
        <Style Selector="Button.NavButton:pointerover">
             <Setter Property="Background" Value="#1AFFFFFF"/>
             <Setter Property="Foreground" Value="White"/>
        </Style>
    </Window.Styles>

    <Border Background="#F2111111" CornerRadius="12" BorderBrush="#33FFFFFF" BorderThickness="1" ClipToBounds="True">
        <Grid RowDefinitions="60, *">
            
            <!-- Header -->
            <Grid Grid.Row="0" Background="#111111" ColumnDefinitions="Auto, *, Auto">
                <StackPanel Orientation="Horizontal" Spacing="15" Margin="20,0">
                    <TextBlock Text="Mod Manager" VerticalAlignment="Center" FontSize="20" FontWeight="Bold" Foreground="White"/>
                    <Rectangle Width="1" Height="20" Fill="#333" VerticalAlignment="Center"/>
                    
                    <!-- Tabs -->
                    <StackPanel Orientation="Horizontal" Spacing="5">
                        <Button Classes="NavButton" Command="{Binding SwitchTabCommand}" CommandParameter="installed">
                            <Panel>
                                <TextBlock Text="Installed" IsVisible="{Binding IsBrowseTab}"/>
                                <TextBlock Text="Installed" IsVisible="{Binding IsInstalledTab}" Foreground="White" FontWeight="Bold"/>
                            </Panel>
                        </Button>
                        <Button Classes="NavButton" Command="{Binding SwitchTabCommand}" CommandParameter="browse">
                            <Panel>
                                <TextBlock Text="Browse" IsVisible="{Binding IsInstalledTab}"/>
                                <TextBlock Text="Browse" IsVisible="{Binding IsBrowseTab}" Foreground="White" FontWeight="Bold"/>
                            </Panel>
                        </Button>
                    </StackPanel>
                </StackPanel>
                
                <Button Grid.Column="2" Command="{Binding CloseCommand}" Margin="0,0,20,0" Content="âœ•" Width="40" Height="40" Background="Transparent" Foreground="White" VerticalContentAlignment="Center" HorizontalContentAlignment="Center"/>
            </Grid>

            <!-- Content -->
            <Grid Grid.Row="1" Background="#1E1E1E">
                
                <!-- Loading Overlay -->
                <Grid Panel.ZIndex="10" Background="#80000000" IsVisible="{Binding IsLoading}">
                    <TextBlock Text="Loading..." HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="White" FontSize="18"/>
                </Grid>
                
                <!-- Installed Tab -->
                <Grid IsVisible="{Binding IsInstalledTab}" Margin="20">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <TextBox Grid.Row="0" Watermark="Search mods..." Margin="0,0,0,15" Background="#252525" Foreground="White" BorderThickness="0" Padding="12"/>
                    
                    <ListBox Grid.Row="1" ItemsSource="{Binding InstalledMods}" Background="Transparent">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Border Background="#252525" CornerRadius="6" Padding="12" Margin="0,0,0,8">
                                    <Grid ColumnDefinitions="50, *, Auto">
                                         <Border Grid.Column="0" Width="42" Height="42" Background="#333" CornerRadius="6" Margin="0,0,15,0">
                                            <TextBlock Text="M" HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="#555"/>
                                         </Border>
                                         
                                         <StackPanel Grid.Column="1" VerticalAlignment="Center" Spacing="2">
                                             <TextBlock Text="{Binding Name}" FontWeight="Bold" Foreground="White" FontSize="16"/>
                                             <TextBlock Text="{Binding Description}" FontSize="13" Foreground="#999" TextTrimming="CharacterEllipsis"/>
                                         </StackPanel>
                                         
                                         <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="10" VerticalAlignment="Center">
                                             <TextBlock Text="{Binding Version}" VerticalAlignment="Center" Foreground="#666" Margin="0,0,10,0"/>
                                             <Button Content="ðŸ—‘" Background="Transparent" Foreground="#FF6B6B" Padding="8" BorderThickness="0"/>
                                         </StackPanel>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </Grid>
                
                <!-- Browse Tab -->
                <Grid IsVisible="{Binding IsBrowseTab}" Margin="20">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <Grid Grid.Row="0" Margin="0,0,0,15" ColumnDefinitions="*, Auto">
                         <TextBox Grid.Column="0" Text="{Binding SearchQuery}" Watermark="Search CurseForge..." Background="#252525" Foreground="White" BorderThickness="0" Padding="12"/>
                         <Button Grid.Column="1" Command="{Binding SearchCommand}" Content="Search" Margin="10,0,0,0" Background="#333" Foreground="White" Padding="20,0"/>
                    </Grid>
                    
                    <ListBox Grid.Row="1" ItemsSource="{Binding SearchResults}" Background="Transparent">
                        <ListBox.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel ItemWidth="230" ItemHeight="300"/>
                            </ItemsPanelTemplate>
                        </ListBox.ItemsPanel>
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Border Background="#252525" CornerRadius="8" Padding="10" Margin="5" Width="220" Height="290">
                                    <Grid RowDefinitions="Auto, *, Auto">
                                        <!-- Placeholder for Image -->
                                        <Border Grid.Row="0" Height="120" Background="#333" CornerRadius="6" Margin="0,0,0,10">
                                             <TextBlock Text="IMG" HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="#555"/>
                                        </Border>
                                        
                                        <StackPanel Grid.Row="1" Spacing="4">
                                            <TextBlock Text="{Binding Name}" FontWeight="Bold" Foreground="White" FontSize="14" TextTrimming="CharacterEllipsis"/>
                                            <TextBlock Text="{Binding Summary}" FontSize="12" Foreground="#999" TextWrapping="Wrap" MaxLines="3" TextTrimming="CharacterEllipsis"/>
                                            <TextBlock Text="{Binding Author}" FontSize="11" Foreground="#666"/>
                                        </StackPanel>
                                        
                                        <Button Grid.Row="2" Content="Download" Margin="0,10,0,0" HorizontalAlignment="Stretch" HorizontalContentAlignment="Center" Background="#444" Foreground="White"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </Grid>

            </Grid>
        </Grid>
    </Border>

</Window>
